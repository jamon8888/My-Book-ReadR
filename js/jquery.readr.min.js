// Remixed by @molokoloco 2011 - http://b2bweb.fr
// Src : https://github.com/molokoloco/My-Book-ReadR/ - V0.99

var disqus_url="http://www.b2bweb.fr/bonus/piratons-la-democratie.html",disqus_identifier="pirate",disqus_domain="disqus.com",disqus_shortname="piratonsladmocratie",disqus_title="Piratons la d&eacute;mocratie"; $(document).ready(function(){var S=disqus_url?!0:!1,i=$(window),x=$(document),m=$("body"),g=$("#section"),T=$("#section h1,#section h2,#section h4"),d=$("#section article > p:not(:empty)"),h=$("#aside"),c="",j=h.find("ul#summary"),G="",H=h.find("ul#paginettes"),r="",v=$("#disqus_thread"),w="html, body",s=$("#resizeHandle"),ca=$("a.top"),I=$("#minibar"),e=62.5,J=0,y=0,f=0,K=0,z=null,L=null,k=null,M=!1,n=function(a,b){$.ajax({url:a,dataType:"script",async:b,cache:!0,error:function(){alert("Sorry, some JS file not found : "+ a)}})};n("./js/waypoints.min.js",0);n("./js/jquery.mousewheel.min.js",0);n("./js/jquery.zclip.min.js",0);y=i.width();f=i.height();$(w).each(function(){var a=$(this).scrollTop();$(this).scrollTop(a+1);if($(this).scrollTop()==a+1)return w=this.nodeName.toLowerCase(),!1});d.find("br").after('<span class="indent"></span>');$.waypoints.settings.scrollThrottle=200;$.waypoints.settings.resizeThrottle=200;var N="";T.each(function(a){$(this).data({id:a}).before('<a name="chapter_'+(a+1)+'" id="chapter_'+(a+ 1)+'"></a>');N+='<li style="padding-left:'+(parseInt(this.nodeName[1])-1)*3+'px;"><a href="#chapter_'+(a+1)+'" data-id="'+a+'">'+$(this).text()+"</a></li>"}).waypoint({offset:"10%"});$(N).appendTo(j);N=null;G=j.find("a");G.bind("click.readr",function(){setTimeout(function(a){T.eq(a).trigger("waypoint.reached")},1E3,$(this).data("id"))});d.waypoint({offset:"35%"});var O=function(a){$("#section article > p.p-actif").removeClass("p-actif");a.addClass("p-actif").prev("p").addClass("p-actif").end().next("p").addClass("p-actif")}, U=function(){var a=i.scrollTop(),a=a<1?0:Math.floor(K/((J+f)/a));r.removeClass("current").eq(a>0?a:0).addClass("current")},V=function(){A((parseInt($(this).text())-1)*f)},W=function(){J=g.height();K=Math.ceil((J+f)/f);H.empty();r&&r.unbind("click.readr",V);for(var a="",b=0;b<K;b++)a+='<li><a href="#screen_'+(b+1)+'">'+(b+1)+"</a></li>";$(a).appendTo(H);r=H.find("a");r.bind("click.readr",V);U()};W();m.delegate("#section h1,#section h2,#section h4","waypoint.reached",function(a,b){var c=$(this).data("id"), c=G.removeClass("current").eq(b=="up"&&c>1?c-1:c).addClass("current").attr("href");M||(L&&clearTimeout(L),L=setTimeout(function(a){if(window.location.hash!=a)window.location.hash=a+"_screen",$(w).stop()},300,c))}).delegate("#section article > p:not(:empty)","waypoint.reached",function(a,b){var c=$(this);k&&clearTimeout(k);k=setTimeout(function(a,b){b==="up"&&(a=a.prev("p"));a.length||a.end();O(a)},1250,c,b)}).delegate("#section article > p:not(:empty)","mouseenter.readr",function(){var a=$(this); k&&clearTimeout(k);k=setTimeout(function(a){O(a)},1400,a)}).delegate("#section article > p:not(:empty)","mouseleave.readr",function(){k&&clearTimeout(k)}).delegate("#section span.comment > a","click.readr",function(a){a.preventDefault();O($(this).closest("p"));S&&embedDisqus($(this).attr("href"),$(this).data("disqus-identifier"))}).bind("mousewheel",function(a,b){a.preventDefault();a.ctrlKey?b>0?o(e+5):o(e-5):b>0?B(-0.5):B(0.5)});S?d.each(function(a){$(this).append('<span class="comment"><a href="'+ disqus_url+"?pirate="+a+'#disqus_thread" data-disqus-identifier="pirate='+a+'" id="pirate_'+a+'" title="Commenter le texte (P#'+a+')">-</a></span>')}):v.remove();var P=function(){v.addClass("fade").empty();x.unbind("click.readr",P);v.unbind("click.readr",notKillDisqus)};notKillDisqus=function(a){a.stopPropagation()};$req=null;embedDisqus=function(a,b){P();disqus_identifier=b||"pirate";disqus_url=a||"http://www.b2bweb.fr/bonus/piratons-la-democratie.html";$req&&$req.abort();$req=$.ajax({url:"http://"+ disqus_shortname+"."+disqus_domain+"/embed.js",dataType:"script",async:!1,cache:!1,success:function(){v.removeClass("fade");v.bind("click.readr",notKillDisqus);x.bind("click.readr",P)}})};var o=function(a){e=a<30?30:a;e=e>60&&e<=65?62.5:e;m.css("font-size",a+"%");setTimeout(function(){i.trigger("resize.readr")},500)};$("#zoomplus").bind("click.readr",function(){o(e+5)});$("#zoomdefault").bind("click.readr",function(){o(62.5)});$("#zoommoins").bind("click.readr",function(){o(e-5)});$("#fullscreen").bind("click.readr", function(){(!window.screen||!window.screen.availHeight)&&alert("F11 pour naviger comfortablement ;)");self.moveTo(0,0);self.resizeTo(window.screen.availHeight+0.8,window.screen.availWidth*0.8)});var d=h.offset(),C=h.width(),p=h.height(),X=function(){C=c.outerWidth();p=c.outerHeight();asideLeft=parseInt(c.css("left"));asideTop=parseInt(c.css("top"));c.css({top:"",left:"",bottom:f-(asideTop+p)+"px",right:y-(asideLeft+C)+"px"});Q()},Q=function(){C=c.outerWidth();p=c.outerHeight();asideRight=parseInt(c.css("right")); asideBottom=parseInt(c.css("bottom"));asideRight<12&&(asideRight=12);asideBottom<12&&(asideBottom=12);p+24>f?(p=f-24-23,h.height(p+"px"),asideBottom=12):h.height("");c.css({bottom:asideBottom+"px",right:asideRight+"px"})};h.removeClass("aside roundered").dialog({dialogClass:"aside",resizable:!1,position:[d.left,d.top-23],scroll:!1,width:C,height:p+23,autoOpen:!0,show:"",hide:"",open:function(){c=h.parent("div.ui-dialog").eq(0).addClass("roundered");c.find(".ui-dialog-titlebar-close").replaceWith('<a href="javascript:void(0)" class="ui-dialog-titlebar-toggle" role="button" title="Reduire/Agrandir">Toggle</a>'); h.height("").width("100%");X()},dragStop:X});$("div.ui-dialog .ui-dialog-titlebar-toggle").bind("click.readr",function(a){a.preventDefault();parseInt(c.height())<=23?(c.height(""),setTimeout(function(){Q()},1E3),$(this).removeClass("toggled")):(c.height("23px"),$(this).addClass("toggled"));return!1});var A=function(a){M=!0;var b=$(w).scrollTop();$(w).stop(!0,!1).animate({scrollTop:a},{duration:250+Math.min(3600,Math.abs(a-b)*0.4),complete:function(){if(z)window.location.hash=z;z=null;M=!1}})},B=function(a){var b= parseInt(i.scrollTop(),10),a=parseInt(f*0.75*a);A(b+a)};$.fn.scrollToMe=function(a){return this.each(function(){a&&(z=a);A(parseInt($(this).offset().top,10))})};$('a[href^="#"]').bind("click.readr",function(a){if(!a.isDefaultPrevented()){a.preventDefault();$(this);var a=this.hash,b=$(a);if(b)return b.scrollToMe(a),!1}});var q=null,D=null,da=function(){y=i.width();f=i.height();Y();W();Q();c.addClass("highlight");$.waypoints("refresh");q=setTimeout(function(){c.removeClass("highlight")},2E3)};i.bind("scroll.readr", function(){c.addClass("highlight");D||(D=setInterval(U,100));q&&clearTimeout(q);q=setTimeout(function(a,b){clearInterval(D);D=null;ca.toggleClass("fade",a<b);c.removeClass("highlight")},300,$(this).scrollTop(),f)}).bind("resize.readr",function(){q&&clearTimeout(q);q=setTimeout(da,250)});var E={},d=function(){if(E.length>0)return E;window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,b,c){E[b]=c});return E},j=window.location.hash;d().pirate?$("a#pirate_"+d().pirate).scrollToMe("#pirate_"+ d().pirate):j&&(j=j.split("_screen"),j.length>0&&$(j[0]).scrollToMe());d=function(){var a=g.attr("contenteditable")!="true"?!0:!1;g.attr("contenteditable",a?"true":"false").toggleClass("editable",a).attr("title",a?"Vous pouvez maintenant editer le texte (Double clic pour sortir)":"")};g.bind("dblclick.readr",d);var ea={37:"left",39:"right",38:"up",40:"down",13:"enter",27:"esc",32:"space",107:"+",109:"-",33:"pageUp",34:"pageDown",96:0,97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,48:0,49:1,50:2, 51:3,52:4,53:5,54:6,55:7,56:8,57:9},fa=function(){$("#copier").zclip({path:"./js/ZeroClipboard.swf",copy:l,beforeCopy:function(){},afterCopy:function(){$("#copier").zclip("remove")}})};killMiniBar=function(){I.fadeOut(500,function(){$(this).hide()})};protectMiniBar=function(){clearMiniBar();F=setTimeout(killMiniBar,2600)};clearMiniBar=function(){F&&clearTimeout(F)};I.bind("mouseover.readr",protectMiniBar).fadeOut();$("#editer").bind("click.readr",d);var t=null,F=null,R=s.width(),u=0,Z=0,l="",Y=function(){t&& clearInterval(t);t=setInterval(function(){s.css({top:parseInt(g.offset().top,10)+"px",left:parseInt(g.offset().left,10)+g.outerWidth()-R+"px",height:g.outerHeight()-2+"px"})},150)},aa=function(a){s.css({left:parseInt(a.pageX,10)-R/2+"px"});t&&clearInterval(t);t=setInterval(function(a){u=100-(a+R/2)/y*100;u=u>70?70:u<2?2:u;g.css({marginRight:u+"%"});i.trigger("resize.readr")},800,parseInt(a.pageX,10))},ba=function(a){window.scrollBy(0,Z-parseInt(a.pageY,10))};Y();x.focus().bind("mousedown.readr",function(a){if($(a.target).is(s))return a.preventDefault(), s.css("background","rgba(0,0,0,0.2)"),m.bind("mousemove.readr",aa),!1;else if($(a.target).is(x)||$(a.target).is(m)||$(a.target).is(g)||$(a.target).is("article"))return a.preventDefault(),Z=parseInt(a.pageY,10),m.bind("mousemove.readr",ba),!1}).bind("keydown.readr",function(a){var b=ea[a.which||a.keyCode]||"";switch(b){case "up":a.preventDefault();B(-1);break;case "down":case "space":a.preventDefault();B(1);break;case "left":a.preventDefault();o(e-5);break;case "right":a.preventDefault();o(e+5);break; case "enter":a.preventDefault();A(0);break;default:b>0&&r.eq(b-1).trigger("click.readr")}}).bind("mouseup.readr click.readr",function(a){m.unbind("mousemove.readr",aa);s.css("background","");m.unbind("mousemove.readr",ba);if(!($(a.target).parents("#section").length<1)){l="";if("getSelection"in window)l=window.getSelection();else if("getSelection"in document)l=document.getSelection();else if("selection"in document)l=document.selection.createRange().text;l=$.trim(l)+"";if(l!=""){var b=a.pageX,a=a.pageY; clearMiniBar();I.stop(!0,!1).css({top:parseInt(a,10)+25+"px",left:parseInt(b,10)+5+"px"}).show().fadeIn(500);F=setTimeout(killMiniBar,2600);fa()}}});n("http://"+disqus_shortname+".disqus.com/count.js",1);n("https://apis.google.com/js/plusone.js",1);n("http://platform.twitter.com/widgets.js",1);$("iframe#facebook").load(function(){n("http://connect.facebook.net/en_US/all.js#appId=235087756512662&amp;xfbml=1",1)}).attr("src","http://www.facebook.com/plugins/like.php?app_id=235087756512662&amp;href&amp;send=false&amp;layout=button_count&amp;width=120&amp;height=20&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font")});