// Remixed by @molokoloco 2011 - http://b2bweb.fr
// Src : https://github.com/molokoloco/My-Book-ReadR/

var readr=function(){var O=disqus_url?!0:!1,f=$("#article"),fa=$("#article h1,#article h2,#article h4"),Ba=$("#article > p:not(:empty)"),h=$("#aside"),d=$(),Ca=h.find("ul#summary"),ga=$(),ha=h.find("ul#viewport"),H=$(),w=$("#help"),I=$("#disqus_thread"),p=$("#resizeHandle"),qb=$("#dragLeft"),Da=$("#dragRight"),rb=$("a.top"),sb=$("#zoomplus"),tb=$("#zoomdefault"),ub=$("#zoomminus"),vb=$("#fullscreen"),wb=$("#autoplay"),P=$("#helpPanel"),x=$("#minibar"),Ea=x.find("#copier"),xb=x.find("#editer"),yb=
x.find("#noter"),ia=$("#notes"),ja=ia.find("#notesList"),zb=ia.find("#saveNotes"),q=$(),g=$(window),r=$(document),i=$("body"),ka="html, body",Q=$(),Ab=/chrome\//.test(navigator.userAgent.toLowerCase()),n=0,la="",ma=null,j=null,R=!1,J=!1,na=function(){"console"in window&&console.log.call(console,arguments)},k=function(a,b,c){$.ajax({url:a,async:b||0,dataType:"script",cache:1,error:function(){alert("Sorry, some JS file not found : "+a)},success:function(){c&&"function"==typeof c&&c()}})};k("./js/jquery-ui-1.8.14.custom.min.js",
0);k("./js/waypoints.min.js",0);k("./js/jquery.mousewheel.min.js",0);$(ka).each(function(){var a=parseInt($(this).scrollTop(),10);g.scrollTop(a+1);if($(this).scrollTop()==a+1)return ka=this.nodeName.toLowerCase(),!1});var Q=$(ka),pa=function(){1>oa.length&&window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,b,c){oa[b]=c});return oa},oa={},e=function(){return g.height()},y=function(){return parseInt(Q.scrollTop()||g.scrollTop(),10)},z=function(a){R=!0;var b=360+0.42*Math.abs(a-y());2222<
b&&(b=0);Q.stop(!0,!1).animate({scrollTop:a},{duration:b,complete:function(){var a=la;if(a&&(window.location.hash||"")!=a)window.location.hash=a;la="";R=!1}})},A=function(a){a=parseInt(0.75*e()*a,10);z(y()+a)};$.fn.extend({scrollToMe:function(a){return this.each(function(){a&&(la=a);z(parseInt($(this).offset().top,10))})},center:function(){return this.each(function(){var a=$(this),b=(e()-a.outerHeight())/2,c=(g.width()-a.outerWidth())/2;a.css({top:(16<b?b:16)+"px",left:(16<c?c:16)+"px"})})}});$.waypoints.settings.scrollThrottle=
200;$.waypoints.settings.resizeThrottle=200;var S="";fa.each(function(a){S+='<li style="padding-left:'+3*(parseInt(this.nodeName[1],10)-1)+'px;"><a href="#chapter_'+(a+1)+'" data-id="'+a+'">'+$(this).text()+"</a></li>"}).waypoint({offset:"10%"});$(S).appendTo(Ca);S=null;ga=Ca.find("a");ga.bind("click.readr",function(){setTimeout(function(a){fa.eq(a).trigger("waypoint.reached")},1E3,$(this).data("id"))});Ba.waypoint({offset:"35%"});var qa=function(a){$("#article > p.p-actif").removeClass("p-actif");
a.addClass("p-actif").prev("p").addClass("p-actif").end().next("p").addClass("p-actif")};if(O)var ra=null,sa=function(){I.addClass("fade").empty();r.unbind("click.readr",sa);I.unbind("click.readr",Fa)},Fa=function(a){a.stopPropagation()},Bb=function(a,b){sa();window.disqus_identifier=b||"pirate";window.disqus_url=a||"http://www.b2bweb.fr/bonus/piratons-la-democratie.html";ra&&ra.abort();ra=$.ajax({url:"http://"+disqus_shortname+"."+disqus_domain+"/embed.js",dataType:"script",async:!1,cache:!1,success:function(){I.removeClass("fade");
I.bind("click.readr",Fa);r.bind("click.readr",sa)}})};else I.remove();var Ga=function(){fa.each(function(a){$(this).data({id:a}).before('<a name="chapter_'+(a+1)+'" id="chapter_'+(a+1)+'"></a>')});O&&Ba.each(function(a){$(this).append('<span class="comment"><a href="'+disqus_url+"?pirate="+a+'#disqus_thread" data-disqus-identifier="pirate='+a+'" id="pirate_'+a+'" title="Commenter le texte (P#'+a+')">-</a></span>')})};Ga();var Ha=function(a,b){var c=$(this).data("id"),c=ga.removeClass("current").eq("up"==
b&&1<c?c-1:c).addClass("current").attr("href");ma&&clearTimeout(ma);R||(ma=setTimeout(function(a){if((window.location.hash||"")!=a)if((a+="_screen")&&(window.location.hash||"")!=a)window.location.hash=a},400,c))},Ia=function(a,b){var c=$(this);j&&clearTimeout(j);j=setTimeout(function(a,b){"up"===b&&(a=a.prev("p"));a.length||a.end();qa(a)},1250,c,b)},Ja=function(){var a=$(this);j&&clearTimeout(j);j=setTimeout(function(a){qa(a)},1400,a)},Ka=function(){j&&(clearTimeout(j),j=null)},La=function(a){a.preventDefault();
qa($(this).closest("p"));O&&Bb($(this).attr("href"),$(this).data("disqus-identifier"));return!1},Ma=h.offset(),T=h.width(),l=h.height(),Na=parseInt(d.css("left"),10),Oa=parseInt(d.css("top"),10),U=parseInt(d.css("right"),10),s=parseInt(d.css("bottom"),10),Pa=function(){T=d.outerWidth();l=d.outerHeight();Na=parseInt(d.css("left"),10);Oa=parseInt(d.css("top"),10);d.css({top:"",left:"",bottom:e()-(Oa+l)+"px",right:g.width()-(Na+T)+"px"});V()},V=function(){h.height("");T=d.outerWidth();l=d.outerHeight();
U=parseInt(d.css("right"),10);s=parseInt(d.css("bottom"),10);16>U&&(U=16);16>s&&(s=16);s+l+16>e()&&(s=e()-l-16);l+32>e()&&(l=e()-32-23,h.height(l+"px"),s=16);d.css({bottom:s+"px",right:U+"px"})},Cb=function(a){a.preventDefault();23>=parseInt(d.height(),10)?(d.height(""),setTimeout(function(){V()},1E3),$(this).removeClass("toggled"),V()):(d.height("23px"),$(this).addClass("toggled"));return!1};h.removeClass("aside roundered").dialog({dialogClass:"aside",resizable:!1,position:[Ma.left,Ma.top-23],scroll:!1,
width:T,height:l+23,stack:!1,open:function(){d=h.parent("div.ui-dialog").eq(0).addClass("roundered").css("z-index","250");d.find(".ui-dialog-titlebar-close").replaceWith('<a href="javascript:void(0)" class="ui-dialog-titlebar-toggle" role="button" title="Reduire/Agrandir">Toggle</a>');d.find(".ui-dialog-titlebar-toggle").bind("click.readr",Cb);w.detach().appendTo(d.find(".ui-dialog-titlebar"));h.height("").width("100%");Pa()},dragStop:Pa});var ta=function(){var a=0,a=y(),b=(n-1)*e(),a=a<e()?1:a>=
b?n:Math.ceil(n*(a/b));H.removeClass("current").eq(a-1).addClass("current")},Qa=function(a){a.preventDefault();var a=parseInt($(this).text(),10)-1,b=a*e();a==n-1&&(b=(n-1)*e());z(b);return R=!1},Ra=function(){n=Math.ceil(r.height()/e());0<H.lenght&&H.unbind("click.readr",Qa);ha.empty();if(!(1>n)){for(var a=0,b="";a<n;a++)b+='<li><a href="#screen_'+(a+1)+'">'+(a+1)+"</a></li>";$(b).appendTo(ha);H=ha.find("a");H.bind("click.readr",Qa);ta();V()}};Ra();$('a[href^="#"]').live("click.readr",function(a){if(!a.isDefaultPrevented()){var b=
this.hash,c=$(b);if(c)return a.preventDefault(),c.scrollToMe(b),!1}});var m=62.5,B=null,ua=5,K=function(a){m=30>a?30:a;m=60<m&&65>=m?62.5:m;i.css("font-size",a+"%");t("Taille du texte : "+parseInt(100*(a/62.5),10)+"%");setTimeout(va,500)};sb.bind("click.readr",function(){K(m+5)});tb.bind("click.readr",function(){K(62.5)});ub.bind("click.readr",function(){K(m-5)});vb.bind("click.readr",function(){if(!("resizeTo"in window)||!("screen"in window)||!("availHeight"in window.screen)||Ab)return alert("Votre navigateur n'autorise pas la page a activer cette fonction...\n\nTouche F11 pour lire confortablement !");
window.moveTo(0,0);return window.resizeTo(0.85*window.screen.availHeight,0.85*window.screen.availWidth)});var wa=function(){if(J)L();else{J=!0;var a=450*(10-ua);Sa();B&&clearInterval(B);B=setInterval(Sa,a);t("D&eacute;filement automatique, vitesse : "+ua+"/10")}},L=function(){J&&(B&&clearInterval(B),B=null,J=!1,t("D&eacute;filement automatique stopp&eacute;"))},Sa=function(){var a=y()+12;a+e()<r.height()?z(a):L()};wb.bind("click.readr",wa);$("<div/>").css({width:"10em",position:"absolute",right:"-10em"}).appendTo(i);
$("<div/>").css({width:"100px",position:"absolute",right:"-100px"}).appendTo(i);var u=0.25,C=0,W=0,X=null,Y=null,Db=function(){u=0.25;W=C=0;Y=X=null},Ta=function(a,b){a.preventDefault();X&&clearTimeout(X);X=setTimeout(Db,!W||W==b?2400:0);Y||(Y=new Date);var c=(new Date).getSeconds()-Y.getSeconds();10<C&&3>=c||18<C||20==u?u=20:4<C&&2>=c?u=2:2<C&&(u=1);W=b;C++;0<b?A(-u):A(u);return!1},D=null,Z=null,Eb=function(){clearInterval(Z);Z=null;ta();rb.toggleClass("fade",y()<e());d.removeClass("highlight");
M()},Ua=function(){J||d.addClass("highlight");Z||(Z=setInterval(ta,150));D&&clearTimeout(D);D=setTimeout(Eb,333)},va=function(){xa();Ra();L();P.center();$.waypoints("refresh")},Va=function(){D&&clearTimeout(D);D=setTimeout(va,333)},v=$(),Xa=function(){na("buildEditable()");f.find("a[name^='chapter_']").remove();f.find("span.comment").remove();var a=f.html(),a=unescape(a+"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");v=$('<textarea name="textEdit" id="textEdit" cols="80" rows="100">'+
a+"</textarea>").appendTo(i);v.wrap('<form method="post" name="formEdit" id="formEdit" action="actions.php?action=saveText" target="_blank"/>');$("#formEdit").prepend('<button type="submit" id="saveNotes" title="T\u00e9l\u00e9hargez vos notes dans un fichier .txt" accesskey="s 0">Sauver</button>');v.tinymce({script_url:"./tiny_mce/tiny_mce.js",content_css:"./css/styles_tinymce.css",theme:"advanced",skin:"o2k7",theme_advanced_resizing:!1,width:"80%",height:"90%",plugins:"save,autolink,pagebreak,table,advhr,advimage,advlink,iespell,inlinepopups,preview,searchreplace,print,contextmenu,paste,noneditable,visualchars,nonbreaking",
theme_advanced_buttons1:"save,|,newdocument,print,|,undo,redo,|,cut,copy,paste,pastetext,pasteword,|,removeformat,cleanup,|,tablecontrols,|,iespell,visualaid,visualchars,|,search,replace,|,help,|,code",theme_advanced_buttons2:"formatselect,styleselect,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,link,unlink,|,image,|,bullist,numlist,outdent,indent,blockquote,|,sub,sup,|,pagebreak,hr,charmap,nonbreaking,|,forecolor,backcolor",theme_advanced_buttons3:"",
theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom"});setTimeout(function(){$("iframe#textEdit_ifr").css({width:"100%",height:"100%"});$("form#formEdit").bind("submit",Wa)},900)},Wa=function(a){na("saveText()");f.html(v.val());return Fb(a)},Fb=function(a){na("removeEditable()");a&&a.preventDefault();$("form#formEdit").unbind("submit",Wa);v.animate({opacity:0},600,function(){v.tinymce().destroy();$("form#formEdit").remove();v=$()});Ga();
Ya();return!1},Za={37:"left",39:"right",38:"up",40:"down",13:"enter",17:"ctrl",27:"esc",32:"space",107:"+",109:"-",33:"pageUp",34:"pageDown",96:"0",97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,48:"0",49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9},$a=function(a){var b=Za[a.which||a.keyCode]||"",c=!1;switch(b){case "+":K(m+5);c=!0;break;case "-":K(m-5);c=!0;break;case "up":A(-1);c=!0;break;case "down":A(1);c=!0;break;case "left":A(-0.1);c=!0;break;case "right":A(0.1);c=!0;break;case "pageUp":case "pageDown":case "space":case "enter":c=
!0;break;default:b&&0<=b&&(c=!0)}if(c)return a.preventDefault(),!1},ab=function(a){if(!("activeElement"in document&&$(document.activeElement).attr("editable"))){var b=Za[a.which||a.keyCode]||"",c=!1;switch(b){case "pageUp":z(0);c=!0;break;case "pageDown":z(r.height());c=!0;break;case "space":case "enter":wa(a);c=!0;break;default:b&&0<=b&&(1>b?L():(ua=b,wa()),c=!0)}if(c)return a.preventDefault(),!1}},ya=$(),za=$(),aa=0,ba=!1,o=null,cb=function(a){a.preventDefault();var b="";ja.find("div.note").each(function(a){b+=
"\n---\n"+(a+1)+") "+$(this).text()+"\n"});$("input#saveText").val(b);document.formNotes.submit();ba=!1;g.unbind("unload",bb);t("Notes sauv&eacute;es");return!1},bb=function(a){if(ba&&confirm("Voulez vous telecharger vos notes avant de quitter la page ?"))return cb(a)},Aa=function(){o&&clearTimeout(o);o=null;za.fadeOut(300)};ja.delegate("a","mouseenter",function(){Aa();$(this).next("div.note").fadeIn(600)}).delegate("a","mouseleave",function(){za=$(this).next("div.note");o=setTimeout(Aa,1E3)}).delegate("div.note",
"mouseenter",function(){o&&clearTimeout(o);o=null}).delegate("div.note","mouseleave",function(){za=$(this);o=setTimeout(Aa,1E3)});zb.bind("click.readr",cb);var db=function(){Ea.zclip({path:"./js/ZeroClipboard.swf",copy:N,afterCopy:function(){Ea.zclip("remove");t("Texte copi&eacute;");M()}})},M=function(){x.fadeOut(500,function(){$(this).hide();$(this).find("div.zclip").remove()})},eb=function(){ca=setTimeout(M,2600)},fb=function(){ca&&clearTimeout(ca);ca=null};x.bind("mouseover.readr",fb).bind("mouseleave.readr",
eb).hide();xb.bind("click.readr",function(){f.undelegate("#article h1,#article h2,#article h4","waypoint.reached",Ha).undelegate("#article > p:not(:empty)","waypoint.reached",Ia).undelegate("#article > p:not(:empty)","mouseenter.readr",Ja).undelegate("#article > p:not(:empty)","mouseleave.readr",Ka).undelegate("span.comment a","click.readr",La);g.unbind("scroll.readr",Ua).unbind("resize.readr",Va).unbind("mousewheel.readr",Ta);r.unbind("keydown.readr",$a).unbind("keyup.readr",ab).unbind("mousedown.readr",
gb).unbind("mouseup.readr click.readr",hb);ib();da="removeEditable";t("&Eacute;diteur HTML");"function"!=typeof $().tinymce?k("./tiny_mce/jquery.tinymce.js",0,Xa):Xa();M()});yb.bind("click.readr",function(){aa++;ba||(ba=!0,g.bind("unload",bb),ia.show());$('<li><a href="#note_'+aa+'">'+N.substr(0,6)+'</a><div class="note roundered" contenteditable="true">'+N+"</div></li>").appendTo(ja);0<ya.parents("#article").length&&ya.addClass("hightlight").prepend('<a name="note_'+aa+'" id="note_'+aa+'"></a>');
t("Note ajout&eacute;e");M()});var E=null,ca=null,ea=p.width(),F=0,jb=0,N="",lb=function(a){p.css({left:parseInt(a.pageX,10)-ea/2+"px"});E&&clearInterval(E);E=setInterval(kb,500,parseInt(a.pageX,10))},kb=function(a){F=100-100*((a+ea/2)/g.width());F=70<F?70:2>F?2:F;f.css({marginRight:F+"%"});xa();va()},xa=function(){p.css({top:parseInt(f.offset().top,10)+"px",left:parseInt(f.offset().left,10)+f.outerWidth()-ea+"px",height:f.outerHeight()-2+"px"});Da.css({width:g.width()-parseInt(p.css("left"),10)-
ea+"px"})};xa();var mb=function(a){a=y()+(jb-parseInt(a.pageY,10));Q.stop(!0,!1).scrollTop(a)},gb=function(a){L();var b=$(a.target);if(b.is(p))return a.preventDefault(),p.addClass("actif"),i.bind("mousemove.readr",lb),!1;if(b.is(qb)||b.is(Da)||b.is(f))return a.preventDefault(),jb=parseInt(a.pageY,10),i.bind("mousemove.readr",mb),!1},hb=function(a){E&&(clearInterval(E),E=null,i.unbind("mousemove.readr",lb),p.removeClass("actif"),kb(parseInt(a.pageX,10)));i.unbind("mousemove.readr",mb);if($(a.target).is("#article")||
0<$(a.target).parents("#article").length){var b="";if("getSelection"in window)b=window.getSelection();else if("getSelection"in document)b=document.getSelection();else if("selection"in document)b=document.selection.createRange().text;N=$.trim(b)+"";if(""!==N)ya=$(a.target),b=a.pageX,a=a.pageY,fb(),x.stop(!0,!1).css({top:parseInt(a,10)+10+"px",left:parseInt(b,10)+5+"px"}).show().fadeIn(500),"function"!=typeof $().zclip?k("./js/jquery.zclip.min.js",0,db):db(),eb()}},G=window.location.hash||"";pa().pirate?
$("a#pirate_"+pa().pirate).scrollToMe("#pirate_"+pa().pirate):G&&(G=G.split("_screen"),0<G.length&&$(G[0]).scrollToMe(G[0]));var da="",Gb=function(){P.animate({opacity:0},800,function(){P.hide()})},ib=function(a){if(!q.lenght||1>q.lenght)q=$('<div id="'+"#overlay".slice(1)+'" title="Fermer"/>').appendTo(i),q.bind("click.readr",nb);q.show().animate({opacity:1},900);0<a&&setTimeout(nb,a)},nb=function(){da&&(eval(da+"()"),da="");Gb();q.animate({opacity:0},900,function(){q.hide()})};w.bind("click.readr",
function(a){a.preventDefault();ib();P.css({opacity:0}).show().center().animate({opacity:1},1600);return!1});var ob=5,pb=function(){w.is(":visible")?w.fadeOut(300):w.fadeIn(300);ob--;0<=ob?setTimeout(pb,600):w.fadeIn(300)};setTimeout(pb,600);var t=function(a,b){b=b||4E3;$("div#message").remove();$('<div id="message"/>').html("<p>"+a+"</p>").appendTo(i).animate({top:"-2px"},700).delay(b?b:80*a.length).animate({top:"-20px"},400,function(){$(this).remove()})},Ya=function(){f.delegate("#article h1,#article h2,#article h4",
"waypoint.reached",Ha).delegate("#article > p:not(:empty)","waypoint.reached",Ia).delegate("#article > p:not(:empty)","mouseenter.readr",Ja).delegate("#article > p:not(:empty)","mouseleave.readr",Ka).delegate("span.comment a","click.readr",La);g.bind("scroll.readr",Ua).bind("resize.readr",Va).bind("mousewheel.readr",Ta);r.bind("keydown.readr",$a).bind("keyup.readr",ab).bind("mousedown.readr",gb).bind("mouseup.readr click.readr",hb).focus()};Ya();$(window).bind("load",function(){O&&k("http://"+disqus_shortname+
".disqus.com/count.js",1);k("https://apis.google.com/js/plusone.js",1);k("http://platform.twitter.com/widgets.js",1);$("iframe#facebook").load(function(){k("http://connect.facebook.net/en_US/all.js#appId=235087756512662&amp;xfbml=1",1)}).attr("src","http://www.facebook.com/plugins/like.php?app_id=235087756512662&amp;href&amp;send=false&amp;layout=button_count&amp;width=120&amp;height=20&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font")})};$(document).ready(readr);